unit lo_colasparciales;

interface

const
  _RUTA = 'C:\Users\Ezequiel\Google Drive\Juan23\PROG2\MIO\TRABAJOFINALDELPHI\Archivos\';
  _ARCHIVO_DATOS = 'TiradasCola.DAT';
  _ARCHIVO_CONTROL = 'TiradasCola.CON';
  __POSNULA= -1;
  __LONGCLAVE = 4;

type
TipoPos = longint;

TipoClave = string[__LONGCLAVE];

TipoDato =  Record
            Numero: integer;
            Enlace: tipoPos;
            End;

TipoArchivoDato = file of TipoDato;

TipoControl = Record
              Pri: tipopos;
              Ult: tipopos;
              bajas: tipopos;
              End;

TipoArchivoControl = file of TipoControl;

TipoCola = record
         D: TipoArchivoDato;
         C: TipoArchivoControl;
         end;

procedure crearME(var cola:TipoCola; archivo:string);
Procedure AbrirMe (Var cola:TipoCola);
Procedure CerrarMe (Var cola:TipoCola);
function colaVacia(var cola:tipocola):boolean;

var
  MeTIRADAS: tipocola;



implementation

procedure crearME(var cola:TipoCola; archivo:string);
var
   berrrorcontrol,berrordatos: boolean;
   rc: tipoControl;
begin
     assign(cola.D, _RUTA + _ARCHIVO_DATOS);
     assign(cola.C, _RUTA + _ARCHIVO_CONTROL);
     {$I-}
     reset(cola.c);
     berrrorcontrol:=ioresult<>0;
     reset(cola.d);
     berrordatos:=ioresult<>0;
     if berrrorcontrol and berrordatos then
     begin
             rewrite(cola.C);
             rewrite(cola.D);
             rc.Pri:=__POSNULA;
             rc.ult:=__POSNULA;
             rc.bajas:=__POSNULA;
             seek(cola.c, 0); //siempre hacer seek
             write(cola.C, rc);

     end;      ///habria que agregar los casos para si hay error en control y otro si hay error en datos

     close(cola.C);
     close(cola.D);
     {$I+}
end;

Procedure AbrirMe (Var cola:TipoCola);
// reset a los 2 archivos del M.E.
Begin
     reset(cola.D);
     reset(cola.C);
End;

Procedure CerrarMe (Var cola:TipoCola);
// close M.E.
Begin
     close(cola.D);
     close(cola.C);
End;

function colaVacia(var cola:tipocola):boolean;
var
  rc: tipocontrol;
begin
     seek(cola.C, 0);
     read(cola.c, rc);
     colaVacia:= (rc.pri = __POSNULA);
end;

end.
